<!DOCTYPE html>
<html lang="tr" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TKGM Mevzuat Sistemi</title>
    
    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- PDF.js for rendering PDFs -->
    <script src="https://mozilla.github.io/pdf.js/build/pdf.mjs" type="module"></script>
    
    <!-- Lucide Icons for clean icons -->
    <script src="https://unpkg.com/lucide-react@0.378.0/dist/lucide-react.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <style>
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; /* bg-gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; /* bg-gray-600 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* bg-gray-500 */
        }
        /* Basic styles for hiding/showing pages */
        .page {
            display: none;
            animation: fadeIn 0.5s;
        }
        .page.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        /* PDF viewer container should be flexible */
        #pdf-container {
            width: 100%;
            height: calc(100vh - 120px); /* Full height minus header/footer */
            overflow: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        #pdf-canvas {
            border: 1px solid #4b5563;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Loading spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0d47a1; /* Fenerbahçe Blue */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans h-full overflow-hidden">

    <div id="app-container" class="h-full flex flex-col">

        <!-- =================================================================== -->
        <!-- ANA SAYFA (HOME PAGE)                                               -->
        <!-- =================================================================== -->
        <main id="home-page" class="page active p-4 sm:p-6 lg:p-8 flex-grow flex flex-col">
            <header class="text-center mb-8">
                <h1 class="text-3xl sm:text-4xl font-bold text-white">
                    <span class="text-yellow-400">TKGM</span> Mevzuat Sistemi
                </h1>
                <p class="text-gray-400 mt-2">Gökhan ELGÜL Müdürüm'e özel</p>
            </header>

            <!-- Arama Çubuğu -->
            <div class="mb-8 max-w-2xl w-full mx-auto">
                <div class="relative">
                    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    </span>
                    <input type="text" id="search-input" placeholder="Mevzuat içinde ara (örn: 2023/5)..." class="w-full bg-gray-800 border border-gray-700 rounded-full py-3 pl-12 pr-4 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition">
                </div>
            </div>
            
            <!-- Arama Sonuçları Alanı -->
            <div id="search-results" class="max-w-2xl w-full mx-auto flex-grow overflow-y-auto"></div>

            <!-- Ana Kategoriler -->
            <div id="main-categories" class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto w-full">
                <!-- Tapu Kartı -->
                <div id="tapu-card" class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 shadow-lg hover:bg-gray-700/70 transition-all duration-300 cursor-pointer flex flex-col items-center justify-center text-center border border-gray-700">
                    <h2 class="text-2xl font-bold text-yellow-400 mb-2">TAPU</h2>
                    <p class="text-gray-300">Tapu Dairesi Başkanlığı ile ilgili genelge ve talimatlar.</p>
                </div>
                <!-- Kadastro Kartı -->
                <div id="kadastro-card" class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 shadow-lg hover:bg-gray-700/70 transition-all duration-300 cursor-pointer flex flex-col items-center justify-center text-center border border-gray-700">
                    <h2 class="text-2xl font-bold text-blue-400 mb-2">KADASTRO</h2>
                    <p class="text-gray-300">Kadastro Dairesi Başkanlığı ile ilgili genelge ve talimatlar.</p>
                </div>
            </div>
        </main>

        <!-- =================================================================== -->
        <!-- LİSTE SAYFASI (LIST PAGE)                                           -->
        <!-- =================================================================== -->
        <section id="list-page" class="page p-4 sm:p-6 lg:p-8 flex-grow flex flex-col h-full">
            <header class="flex items-center mb-6">
                <button id="back-to-home-btn" class="p-2 rounded-full hover:bg-gray-700 transition mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                </button>
                <h2 id="list-title" class="text-2xl sm:text-3xl font-bold">Liste Başlığı</h2>
            </header>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                 <button id="genelge-btn" class="w-full bg-gray-800 border border-gray-700 rounded-lg py-3 px-4 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition">Genelgeler</button>
                 <button id="talimat-btn" class="w-full bg-gray-800 border border-gray-700 rounded-lg py-3 px-4 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition">Talimatlar</button>
            </div>
            <div id="pdf-list" class="flex-grow overflow-y-auto space-y-3 pr-2">
                <!-- PDF listesi buraya dinamik olarak eklenecek -->
            </div>
        </section>

        <!-- =================================================================== -->
        <!-- PDF GÖRÜNTÜLEYİCİ SAYFASI (PDF VIEWER PAGE)                         -->
        <!-- =================================================================== -->
        <section id="pdf-viewer-page" class="page flex-grow flex flex-col h-full bg-gray-900">
            <header class="flex items-center justify-between p-3 bg-gray-800 shadow-md flex-shrink-0">
                <button id="back-to-list-btn" class="p-2 rounded-full hover:bg-gray-700 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                </button>
                <h3 id="pdf-title" class="text-sm sm:text-lg font-bold text-center truncate mx-2"></h3>
                <div class="flex items-center space-x-2">
                    <button id="zoom-out-btn" class="p-2 rounded-full hover:bg-gray-700 transition"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="8" y1="11" x2="14" y2="11"></line></svg></button>
                    <button id="zoom-in-btn" class="p-2 rounded-full hover:bg-gray-700 transition"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg></button>
                </div>
            </header>
            
            <div id="pdf-render-area" class="flex-grow relative bg-gray-800/50">
                <div id="loader" class="loader" style="display: none;"></div>
                <div id="pdf-container">
                    <canvas id="pdf-canvas"></canvas>
                </div>
            </div>

            <footer class="flex items-center justify-between p-2 bg-gray-800 flex-shrink-0">
                <button id="prev-page-btn" class="p-2 rounded-full hover:bg-gray-700 transition">Önceki Sayfa</button>
                <div id="page-num" class="text-sm"></div>
                <button id="next-page-btn" class="p-2 rounded-full hover:bg-gray-700 transition">Sonraki Sayfa</button>
            </footer>
        </section>

    </div>

    <script type="module">
        // ===================================================================
        // UYGULAMA AYARLARI VE VERİLER
        // ===================================================================
        
        // GÜNCELLENDİ: GitHub kullanıcı adınız ve repo adınız.
        const GITHUB_USERNAME = "gokhangeo";
        const GITHUB_REPO = "tkgm-documents";
        const GITHUB_BRANCH = "main"; // Genellikle 'main' veya 'master' olur
        
        const githubBaseUrl = `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${GITHUB_REPO}/${GITHUB_BRANCH}/`;

        // GÜNCELLENDİ: Mevzuat veritabanı.
        // Lütfen bu listeyi GitHub deponuzdaki gerçek PDF dosyalarınızla güncelleyin.
        // 'title' kullanıcıya görünecek başlık, 'path' ise GitHub'daki dosya yoludur.
        const mevzuatData = {
            tapu: {
                genelge: [
                    // Örnek: { title: "2024/1 Sayılı Genelge", path: "tapu/genelgeler/2024-1.pdf" },
                    { title: "Tapu Genelge Örneği 1", path: "tapu/genelgeler/ornek1.pdf" },
                ],
                talimat: [
                    // Örnek: { title: "Web Tapu Kullanım Talimatı", path: "tapu/talimatlar/webtapu.pdf" },
                ]
            },
            kadastro: {
                genelge: [
                    // Örnek: { title: "2023/5 Sayılı Genelge - 22/A", path: "kadastro/genelgeler/2023-5.pdf" },
                ],
                talimat: [
                    // Örnek: { title: "TUSAGA-Aktif Kullanım Talimatı", path: "kadastro/talimatlar/tusaga-aktif.pdf" },
                ]
            }
        };

        // ===================================================================
        // DOM ELEMENTLERİ
        // ===================================================================
        const pages = {
            home: document.getElementById('home-page'),
            list: document.getElementById('list-page'),
            viewer: document.getElementById('pdf-viewer-page')
        };
        
        const searchInput = document.getElementById('search-input');
        const searchResultsContainer = document.getElementById('search-results');
        const mainCategoriesContainer = document.getElementById('main-categories');

        const tapuCard = document.getElementById('tapu-card');
        const kadastroCard = document.getElementById('kadastro-card');
        const backToHomeBtn = document.getElementById('back-to-home-btn');
        
        const listTitle = document.getElementById('list-title');
        const pdfListContainer = document.getElementById('pdf-list');
        const genelgeBtn = document.getElementById('genelge-btn');
        const talimatBtn = document.getElementById('talimat-btn');

        const backToViewerBtn = document.getElementById('back-to-list-btn');
        const pdfTitle = document.getElementById('pdf-title');
        const loader = document.getElementById('loader');
        const pdfCanvas = document.getElementById('pdf-canvas');
        const pageNumDisplay = document.getElementById('page-num');
        const prevPageBtn = document.getElementById('prev-page-btn');
        const nextPageBtn = document.getElementById('next-page-btn');
        const zoomInBtn = document.getElementById('zoom-in-btn');
        const zoomOutBtn = document.getElementById('zoom-out-btn');
        
        // ===================================================================
        // UYGULAMA DURUMU (STATE)
        // ===================================================================
        let currentSection = null; // 'tapu' or 'kadastro'
        let currentType = 'genelge'; // 'genelge' or 'talimat'
        let pdfDoc = null;
        let pageNum = 1;
        let pageRendering = false;
        let pageNumPending = null;
        let scale = 1.5;

        // ===================================================================
        // SAYFA NAVİGASYONU
        // ===================================================================
        function showPage(pageId) {
            Object.values(pages).forEach(page => page.classList.remove('active'));
            pages[pageId].classList.add('active');
        }

        // ===================================================================
        // ARAMA FONKSİYONLARI
        // ===================================================================
        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase().trim();

            if (query.length < 2) {
                searchResultsContainer.innerHTML = '';
                mainCategoriesContainer.style.display = 'grid';
                return;
            }

            mainCategoriesContainer.style.display = 'none';
            const results = [];
            for (const section in mevzuatData) {
                for (const type in mevzuatData[section]) {
                    mevzuatData[section][type].forEach(doc => {
                        if (doc.title.toLowerCase().includes(query)) {
                            results.push({ ...doc, section, type });
                        }
                    });
                }
            }

            displaySearchResults(results);
        });

        function displaySearchResults(results) {
            if (results.length === 0) {
                searchResultsContainer.innerHTML = `<p class="text-center text-gray-400">Aramanızla eşleşen sonuç bulunamadı.</p>`;
                return;
            }

            searchResultsContainer.innerHTML = results.map(doc => `
                <div class="p-4 bg-gray-800 rounded-lg mb-3 cursor-pointer hover:bg-gray-700 transition" data-path="${doc.path}" data-title="${doc.title}">
                    <h4 class="font-bold text-white">${doc.title}</h4>
                    <p class="text-sm text-gray-400 capitalize">${doc.section} / ${doc.type}</p>
                </div>
            `).join('');
            
            searchResultsContainer.querySelectorAll('div[data-path]').forEach(item => {
                item.addEventListener('click', () => {
                    const path = item.getAttribute('data-path');
                    const title = item.getAttribute('data-title');
                    loadPdf(path, title);
                });
            });
        }

        // ===================================================================
        // LİSTE SAYFASI MANTIĞI
        // ===================================================================
        function showListPage(section) {
            currentSection = section;
            listTitle.textContent = section === 'tapu' ? 'Tapu Mevzuatları' : 'Kadastro Mevzuatları';
            listTitle.className = `text-2xl sm:text-3xl font-bold ${section === 'tapu' ? 'text-yellow-400' : 'text-blue-400'}`;
            
            // Başlangıçta genelgeleri göster
            currentType = 'genelge';
            updateActiveTypeButton();
            populatePdfList();
            showPage('list');
        }

        function populatePdfList() {
            pdfListContainer.innerHTML = '';
            const documents = mevzuatData[currentSection][currentType];
            
            if (!documents || documents.length === 0) {
                 pdfListContainer.innerHTML = `<p class="text-center text-gray-400 mt-8">Bu kategoride henüz belge bulunmuyor.</p>`;
                 return;
            }

            documents.forEach(doc => {
                const item = document.createElement('div');
                item.className = 'p-4 bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-700 transition flex items-center justify-between';
                item.innerHTML = `
                    <span class="font-medium">${doc.title}</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500"><polyline points="9 18 15 12 9 6"></polyline></svg>
                `;
                item.addEventListener('click', () => loadPdf(doc.path, doc.title));
                pdfListContainer.appendChild(item);
            });
        }
        
        function updateActiveTypeButton() {
            if (currentType === 'genelge') {
                genelgeBtn.classList.add('bg-yellow-500', 'text-gray-900', 'font-bold');
                talimatBtn.classList.remove('bg-yellow-500', 'text-gray-900', 'font-bold');
            } else {
                talimatBtn.classList.add('bg-yellow-500', 'text-gray-900', 'font-bold');
                genelgeBtn.classList.remove('bg-yellow-500', 'text-gray-900', 'font-bold');
            }
        }

        genelgeBtn.addEventListener('click', () => {
            currentType = 'genelge';
            updateActiveTypeButton();
            populatePdfList();
        });

        talimatBtn.addEventListener('click', () => {
            currentType = 'talimat';
            updateActiveTypeButton();
            populatePdfList();
        });


        // ===================================================================
        // PDF GÖRÜNTÜLEYİCİ MANTIĞI
        // ===================================================================
        const { pdfjsLib } = globalThis;
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://mozilla.github.io/pdf.js/build/pdf.worker.mjs`;

        async function loadPdf(path, title) {
            const url = githubBaseUrl + path;
            pdfTitle.textContent = title;
            showPage('viewer');
            loader.style.display = 'block';
            pdfCanvas.style.display = 'none';
            
            try {
                pdfDoc = await pdfjsLib.getDocument(url).promise;
                pageNum = 1;
                renderPage(pageNum);
            } catch (error) {
                console.error('PDF yüklenirken hata oluştu:', error);
                loader.style.display = 'none';
                alert('PDF dosyası yüklenemedi. Lütfen GitHub deponuzdaki dosya yolunun doğru olduğundan ve deponuzun "public" olduğundan emin olun.');
                showListPage(currentSection);
            }
        }

        function renderPage(num) {
            pageRendering = true;
            pdfDoc.getPage(num).then(page => {
                const viewport = page.getViewport({ scale: scale });
                const context = pdfCanvas.getContext('2d');
                
                pdfCanvas.height = viewport.height;
                pdfCanvas.width = viewport.width;

                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
                const renderTask = page.render(renderContext);
                
                renderTask.promise.then(() => {
                    pageRendering = false;
                    loader.style.display = 'none';
                    pdfCanvas.style.display = 'block';
                    if (pageNumPending !== null) {
                        renderPage(pageNumPending);
                        pageNumPending = null;
                    }
                });
            });

            pageNumDisplay.textContent = `Sayfa ${num} / ${pdfDoc.numPages}`;
        }

        function queueRenderPage(num) {
            if (pageRendering) {
                pageNumPending = num;
            } else {
                renderPage(num);
            }
        }

        function onPrevPage() {
            if (pageNum <= 1) return;
            pageNum--;
            queueRenderPage(pageNum);
        }

        function onNextPage() {
            if (pageNum >= pdfDoc.numPages) return;
            pageNum++;
            queueRenderPage(pageNum);
        }
        
        function onZoomIn() {
            scale += 0.2;
            renderPage(pageNum);
        }

        function onZoomOut() {
            if (scale <= 0.4) return;
            scale -= 0.2;
            renderPage(pageNum);
        }

        // ===================================================================
        // EVENT LISTENERS (OLAY DİNLEYİCİLER)
        // ===================================================================
        tapuCard.addEventListener('click', () => showListPage('tapu'));
        kadastroCard.addEventListener('click', () => showListPage('kadastro'));
        backToHomeBtn.addEventListener('click', () => showPage('home'));
        backToViewerBtn.addEventListener('click', () => showPage('list'));
        
        prevPageBtn.addEventListener('click', onPrevPage);
        nextPageBtn.addEventListener('click', onNextPage);
        zoomInBtn.addEventListener('click', onZoomIn);
        zoomOutBtn.addEventListener('click', onZoomOut);

    </script>
</body>
</html>
